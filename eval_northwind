-- Active: 1665131827383@@127.0.0.1@3306@northwind


-------------------------------------1) Requêtes d'intérrogation sur la base NorthWind ----------------------------------


--1 - Liste des contacts français :
select CompanyName societe, ContactName contact, ContactTitle fonction, Phone telephone From customers 
WHERE Country = 'France';

--2 - Produits vendus par le fournisseur « Exotic Liquids » :
SELECT ProductName produit,UnitPrice prix from suppliers s
JOIN products p ON p.SupplierID=s.SupplierID
;

--3 - Nombre de produits vendus par les fournisseurs Français dans l’ordre décroissant :
SELECT CompanyName fournisseur,COUNT(*) AS 'nbre produits' FROM suppliers s 
JOIN products p ON p.SupplierID=s.SupplierID
WHERE Country ='France'
GROUP BY fournisseur
ORDER BY COUNT(*) DESC
;

-- 4 - Liste des clients Français ayant plus de 10 commandes :

SELECT CompanyName, COUNT(*) AS nombre_commandes
    FROM customers
    JOIN orders ON customers.CustomerID = orders.CustomerID
    --JOIN `order details` ON orders.OrderID = `order details`.OrderID
    WHERE customers.Country = "France" 
    GROUP BY CompanyName
    HAVING COUNT(*) > 10
    ;

-- 5 - Liste des clients ayant un chiffre d’affaires > 30.000 :

SELECT CompanyName AS "clients", SUM(`order details`.unitPrice * `order details`.Quantity) AS CA, Country as "Country"
    FROM customers
    JOIN orders ON customers.CustomerID = orders.CustomerID
    JOIN `order details` ON orders.OrderID = `order details`.OrderID 
    GROUP BY CompanyName 
    HAVING CA > 30000
    ORDER BY CA DESC
    ;

-- 6 – Liste des pays dont les clients ont passé commande de produits fournis par « Exotic Liquids » :

/*SELECT Country AS pays , COUNT(CompanyName)
FROM products 
JOIN suppliers ON products.SupplierID = suppliers.SupplierID
WHERE CompanyName = 'Exotic Liquids' 
GROUP BY pays ASC
; */

    SELECT customers.Country AS Pays
FROM customers
JOIN orders ON orders.CustomerID = customers.CustomerID
JOIN `order details` ON `order details`.OrderID = orders.OrderID
JOIN products ON products.ProductID = `order details`.ProductID
JOIN suppliers ON suppliers.SupplierID = products.SupplierID
WHERE suppliers.companyName = 'Exotic Liquids'
GROUP BY customers.Country ASC;

--7 – Montant des ventes de 1997 :

SELECT SUM(UnitPrice * Quantity) AS `Montant Ventes 97`
	FROM orders
    JOIN `order details` ON `order details`.OrderID = orders.OrderID
    WHERE YEAR(OrderDate) LIKE "1997";

--8 – Montant des ventes de 1997 mois par mois :

SELECT DISTINCT MONTH(OrderDate) AS MOIS, ROUND(SUM(`order details`.UnitPrice*`order details`.Quantity),2) AS `Montant Ventes 97` 
--  ROUND(mettre,2) pour deux chiffres après la virgule
	FROM orders
    JOIN `order details` ON `order details`.OrderID = orders.OrderID
    WHERE YEAR(OrderDate) IN (1997)
	GROUP BY MONTH(OrderDate);

--9 – Depuis quelle date le client « Du monde entier » n’a plus commandé ?

SELECT  OrderDate
    FROM customers
    JOIN orders ON customers.CustomerID = orders.CustomerID
    WHERE CompanyName LIKE 'Du monde entier'
    ORDER BY OrderDate DESC LIMIT 1;

-- 10 – Quel est le délai moyen de livraison en jours ?

SELECT ROUND(AVG(DATEDIFF(ShippedDate,OrderDate))) AS 'Delai moyen de livraison'
    FROM orders;


-----------------------------------2) Procédures stockées ---------------------------------------
